<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>jQuery Knob demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="jQuery Knob demo" />
                <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
                    
   
    <script src="js/jQueryRotateCompressed.2.2.js"></script>
    <script src="js/spritespin.js" type="text/javascript"></script>
   
     <link rel="stylesheet" href="css/reset.css">

        <link href="css/style.css" rel="stylesheet">
             
</head>
<body class='layout-document'>
   
   <script>
       window.updateFrame = function (f) {
           // trace("frame", f);
          if(!isDown){
rotateKnob(parseInt(f * 360 / 34));
          }
           
       }
       function trace() {
    
           var t = ""
           for (var i = 0; i < arguments.length; i++) {
               t += arguments[i] + "  ";
           }
           console.log("v3: " + t);
           $("div.rotationField").text(t);
       }
       var isDown = false
       function rotateKnob(Degrees) {
           if ($.browser.msie && parseInt($.browser.version, 10) < 9) {

               $("#rotate").rotate({ angle: (Degrees) });

           } else {

               $("#rotate").css({ 'transform': 'rotate(' + (Degrees) + 'deg)', '-webkit-transform': 'rotate(' + (Degrees) + 'deg)', '-o-transform': 'rotate(' + (Degrees) + 'deg)', '-moz-transform': 'rotate(' + (Degrees) + 'deg)', '-ms-transform': 'rotate(' + (Degrees) + 'deg)' });
           }
       }
       function updateKnobMove(e, e2) {

           if (isDown) {

               if (e2 === undefined) {
                   e2 = e
               }
              // trace("updateKnob", e, e.pageX, window.pos.left, $(e2.currentTarget).width());
              // var pageCoords = "( " + (e.pageX - $(e.currentTarget).offset().left) + ", " + (e.pageY - $(e.currentTarget).offset().top) + " )";

              
              // var v1 = { x: 1, y: 0 }, v2 = { x: (e.pageX - $(e.currentTarget).offset().left) - $(e.currentTarget).width() / 2, y: (e.pageY - $(e.currentTarget).offset().top) - $(e.currentTarget).height() / 2 },
               // angleRad = Math.acos((v1.x * v2.x + v1.y * v2.y) / (Math.sqrt(v1.x * v1.x + v1.y * v1.y) * Math.sqrt(v2.x * v2.x + v2.y * v2.y))),
               // angleDeg = angleRad * 180 / Math.PI;
               angleDeg2 = Math.atan2(((e.pageX - window.pos.left) - $(e2.currentTarget).width() / 2), -((e.pageY - window.pos.top) - $(e2.currentTarget).height() / 2)) * (180 / Math.PI);
               if (angleDeg2 < 0) {
                   angleDeg2 += 360
               }
               var Degrees = parseInt(angleDeg2);
               rotateKnob(Degrees);

              // trace("updateKnob-->", angleDeg2);

               var frame = parseInt(34 * Degrees / 360);
               trace("frame:   deg=", Degrees, "* frame=", frame, "* frames length", frames.length, "  pageX=",e.pageX, window.pos.left, $(e2.currentTarget).width(),   "   pageY=", e.pageY, window.pos.top, $(e2.currentTarget).height(),"    e2",e2.currentTarget);
            
               $("#360frames").spritespin("frame", frame, Degrees)
           }



       }

       function updateKnobUp(e) {
          // trace("updateKnobUp");
           isDown = false


       }
       function updateKnobDown(e) {
           isDown = true


       }
       function updateKnob() {



           var number = $("#noise-wheel .result-cw").text();

           var Degrees = parseInt(number);

           if ($.browser.msie && parseInt($.browser.version, 10) < 9) {

               $("#rotate").rotate({ angle: (Degrees) });

           } else {

               $("#rotate").css({ 'transform': 'rotate(' + (Degrees) + 'deg)', '-webkit-transform': 'rotate(' + (Degrees) + 'deg)', '-o-transform': 'rotate(' + (Degrees) + 'deg)', '-moz-transform': 'rotate(' + (Degrees) + 'deg)', '-ms-transform': 'rotate(' + (Degrees) + 'deg)' });
           }

       }
       /*  $(function () {

       $(".knob").knob({
                   
       draw: function () {
       $("#noise-wheel .result-cw").text(this.cv);
       updateKnob();
                       
       }
       });


       });*/
    </script>
   

    
rotation:<div class="rotationField"></div>
down:<div class="down"></div>

<div id="example">
       
        
        
        <div id="wheels">
            
            

            <div id="noise-wheel" class="unScrollable">
		<div class="result-cw"></div>
		<div class="indicator-cw1"><img src="img/metal_button_kurzor.png" id="rotate" class="indicator-cw-img" alt="control wheel indicator" /></div>
		<div class="indicator-cw unScrollable"></div>
            </div>
            
            
            
            
        </div> <!-- wheels end -->
        
    </div> <!-- example end -->
     <div id="360frames" class="unScrollable"></div>
<script>
    $(window).load(function () {





        // Code is encrypted. Don't steal the code, buy it!





        /*  $('.info-tooltip').toggle(function () {
        $(this).css("background", "url(img/info_tooltip_hide.png)")
        $("#info").slideDown("slow");
        }, function () {
        $(this).css("background", "url(img/info_tooltip.png)")
        $("#info").slideUp("slow");
        });
        */



        $('#noise-wheel .indicator-cw').bind('touchmove', function (e) {
            //trace("touchmove---------------------", e.originalEvent.touches[0], e.touch)
            /* for (var i in e.originalEvent.touches[0]) {
            trace("touches[0]", i, ":", e.originalEvent.touches[0][i]);
            }*/
            // updateKnobMove(event.touches[0]);

            if (e.touches === undefined && e.originalEvent !== undefined) {
                // jQuery Event normalization does not preserve the 'event.touches'
                // try to grab touches from the original event
                e.touches = e.originalEvent.touches;

            }



            if (e.touches !== undefined && e.touches.length > 0) {
                // trace("YEAH!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
                updateKnobMove(e.touches[0],e);
            } else {
                updateKnobMove(e);
            }

        });
        $('#noise-wheel .indicator-cw').bind('touchstart', function (event) {

            updateKnobDown();

        });
        $('#noise-wheel .indicator-cw').bind('touchend', function (event) {
            updateKnobUp();

        });

        window.pos = $('#noise-wheel').offset()
        trace("pos", window.pos.left, window.pos.top);



        $("#noise-wheel").mousemove(updateKnobMove);
        $(document).mouseup(updateKnobUp);
        $("#noise-wheel").mousedown(updateKnobDown);



        /**/


        var frames = [
          "images/rad_zoom_001.jpg",
          "images/rad_zoom_002.jpg",
          "images/rad_zoom_003.jpg",
          "images/rad_zoom_004.jpg",
          "images/rad_zoom_005.jpg",
          "images/rad_zoom_006.jpg",
          "images/rad_zoom_007.jpg",
          "images/rad_zoom_008.jpg",
          "images/rad_zoom_009.jpg",
          "images/rad_zoom_010.jpg",
          "images/rad_zoom_011.jpg",
          "images/rad_zoom_012.jpg",
          "images/rad_zoom_013.jpg",
          "images/rad_zoom_014.jpg",
          "images/rad_zoom_015.jpg",
          "images/rad_zoom_016.jpg",
          "images/rad_zoom_017.jpg",
          "images/rad_zoom_018.jpg",
          "images/rad_zoom_019.jpg",
          "images/rad_zoom_020.jpg",
          "images/rad_zoom_021.jpg",
          "images/rad_zoom_022.jpg",
          "images/rad_zoom_023.jpg",
          "images/rad_zoom_024.jpg",
          "images/rad_zoom_025.jpg",
          "images/rad_zoom_026.jpg",
          "images/rad_zoom_027.jpg",
          "images/rad_zoom_028.jpg",
          "images/rad_zoom_029.jpg",
          "images/rad_zoom_030.jpg",
          "images/rad_zoom_031.jpg",
          "images/rad_zoom_032.jpg",
          "images/rad_zoom_033.jpg",
          "images/rad_zoom_034.jpg"
        ];


        $("#360frames").spritespin({
            width: 480,
            height: 327,
            frames: frames.length,
            behavior: "drag", // "hold"
            module: "360",
            sense: -1,
            source: frames,
            animate: false,
            loop: true,
            frameWrap: true,
            frameStep: 1,
            frameTime: 60,
            enableCanvas: true
        });

        $(".spritespin-canvas").addClass("unScrollable");

        document.body.addEventListener('touchmove', function (e) {
           // trace("touchmove catch all", $(e.target).hasClass("unScrollable"), $(e.target).context);
           /* for (var i in $(e.target).context) {
                trace("target", i, ":", $(e.target).context[i]);
            }*/
            if ($(e.target).hasClass("unScrollable")) {
               // trace("hit!!!!!!!!!!!!!!!!");
                e.preventDefault();
            }
        });










    });
</script>
</body>
</html>
